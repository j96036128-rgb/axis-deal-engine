<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ submission.property_id }} - Admin Dashboard - Axis Allocation</title>
    <style>
        :root {
            --black: #1a1a1a;
            --charcoal: #333338;
            --slate: #596068;
            --gray: #808080;
            --light-gray: #d9d9d9;
            --pale-gray: #f2f2f2;
            --white: #ffffff;
            --accent: #26405c;
            --success: #16a34a;
            --success-bg: #dcfce7;
            --warning: #ca8a04;
            --warning-bg: #fef3c7;
            --error: #dc2626;
            --error-bg: #fee2e2;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
            font-size: 16px;
            line-height: 1.6;
            color: var(--charcoal);
            background: var(--pale-gray);
        }

        /* Header */
        .admin-header {
            background: var(--accent);
            color: var(--white);
            padding: 16px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .admin-header h1 {
            font-size: 18px;
            font-weight: 600;
        }

        .admin-header-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .admin-email {
            font-size: 14px;
            opacity: 0.9;
        }

        .logout-btn {
            background: rgba(255, 255, 255, 0.15);
            color: var(--white);
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            text-decoration: none;
        }

        /* Main Content */
        .admin-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 24px;
        }

        /* Back link */
        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            color: var(--accent);
            text-decoration: none;
            font-size: 14px;
            margin-bottom: 16px;
        }

        .back-link:hover {
            text-decoration: underline;
        }

        /* Page Header */
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 24px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--light-gray);
        }

        .page-header-left h2 {
            font-size: 24px;
            color: var(--charcoal);
            margin-bottom: 4px;
        }

        .property-id-display {
            font-family: monospace;
            font-size: 14px;
            color: var(--gray);
        }

        .page-header-right {
            text-align: right;
        }

        /* Status Badges */
        .status-badge {
            display: inline-block;
            padding: 6px 14px;
            border-radius: 16px;
            font-size: 14px;
            font-weight: 500;
        }

        .status-draft { background: #f3f4f6; color: #374151; }
        .status-incomplete { background: #fef3c7; color: #92400e; }
        .status-submitted { background: #dbeafe; color: #1e40af; }
        .status-under_review { background: #e0e7ff; color: #3730a3; }
        .status-unevaluated { background: #f3e8ff; color: #6b21a8; }
        .status-evaluated { background: #dcfce7; color: #166534; }
        .status-evaluated_and_published { background: #d1fae5; color: #065f46; }
        .status-approved { background: #d1fae5; color: #065f46; }
        .status-rejected { background: #fee2e2; color: #991b1b; }
        .status-archived { background: #e5e7eb; color: #374151; }
        .status-withdrawn { background: #fef2f2; color: #991b1b; }

        /* Action Alert */
        .action-alert {
            padding: 14px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .action-alert.success {
            background: var(--success-bg);
            color: var(--success);
        }

        .action-alert.error {
            background: var(--error-bg);
            color: var(--error);
        }

        /* Grid Layout */
        .detail-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 24px;
        }

        @media (max-width: 900px) {
            .detail-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Cards */
        .card {
            background: var(--white);
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.06);
            margin-bottom: 20px;
        }

        .card-header {
            padding: 16px 20px;
            border-bottom: 1px solid var(--pale-gray);
        }

        .card-header h3 {
            font-size: 16px;
            font-weight: 600;
            color: var(--charcoal);
        }

        .card-body {
            padding: 20px;
        }

        /* Info Grid */
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 16px;
        }

        .info-item {
            padding: 12px;
            background: var(--pale-gray);
            border-radius: 6px;
        }

        .info-label {
            font-size: 11px;
            color: var(--gray);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .info-value {
            font-size: 15px;
            font-weight: 500;
            color: var(--charcoal);
        }

        .info-value.highlight {
            font-size: 18px;
            color: var(--success);
        }

        /* Documents */
        .document-list {
            list-style: none;
        }

        .document-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: var(--pale-gray);
            border-radius: 6px;
            margin-bottom: 8px;
        }

        .document-info {
            flex: 1;
        }

        .document-type {
            font-weight: 500;
            color: var(--charcoal);
        }

        .document-filename {
            font-size: 13px;
            color: var(--gray);
            font-family: monospace;
        }

        .document-size {
            font-size: 12px;
            color: var(--gray);
            margin-right: 16px;
        }

        .download-btn {
            padding: 6px 12px;
            font-size: 13px;
            background: var(--accent);
            color: var(--white);
            border: none;
            border-radius: 4px;
            text-decoration: none;
            cursor: pointer;
        }

        .download-btn:hover {
            background: #1d3349;
        }

        .missing-docs {
            padding: 16px;
            background: var(--warning-bg);
            border-radius: 6px;
            color: var(--warning);
        }

        .missing-docs ul {
            margin: 8px 0 0 20px;
        }

        /* Integrity Section */
        .integrity-badge {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 16px;
            border-radius: 6px;
            font-weight: 500;
        }

        .integrity-badge.valid {
            background: var(--success-bg);
            color: var(--success);
        }

        .integrity-badge.invalid {
            background: var(--error-bg);
            color: var(--error);
        }

        .hash-display {
            margin-top: 12px;
            font-size: 13px;
            color: var(--gray);
        }

        .hash-display code {
            background: var(--pale-gray);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
        }

        /* Actions Card */
        .actions-card {
            position: sticky;
            top: 24px;
        }

        .action-section {
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--pale-gray);
        }

        .action-section:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        .action-section h4 {
            font-size: 13px;
            font-weight: 600;
            color: var(--slate);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
        }

        .action-btn {
            display: block;
            width: 100%;
            padding: 12px 16px;
            font-size: 15px;
            font-weight: 600;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            margin-bottom: 10px;
            text-align: center;
        }

        .action-btn.approve {
            background: var(--success);
            color: var(--white);
        }

        .action-btn.approve:hover {
            background: #15803d;
        }

        .action-btn.reject {
            background: var(--error);
            color: var(--white);
        }

        .action-btn.reject:hover {
            background: #b91c1c;
        }

        .action-btn.secondary {
            background: var(--pale-gray);
            color: var(--charcoal);
        }

        .action-btn.secondary:hover {
            background: var(--light-gray);
        }

        .note-input {
            width: 100%;
            padding: 10px 12px;
            font-size: 14px;
            border: 1px solid var(--light-gray);
            border-radius: 6px;
            margin-bottom: 10px;
            resize: vertical;
        }

        .note-input:focus {
            outline: none;
            border-color: var(--accent);
        }

        /* Status Form */
        .status-form {
            margin-top: 12px;
        }

        .status-form select {
            width: 100%;
            padding: 10px 12px;
            font-size: 14px;
            border: 1px solid var(--light-gray);
            border-radius: 6px;
            margin-bottom: 10px;
            background: var(--white);
        }

        /* Version History */
        .history-timeline {
            border-left: 2px solid var(--light-gray);
            margin-left: 8px;
            padding-left: 20px;
        }

        .history-item {
            position: relative;
            margin-bottom: 20px;
        }

        .history-item::before {
            content: '';
            position: absolute;
            left: -25px;
            top: 4px;
            width: 10px;
            height: 10px;
            background: var(--accent);
            border-radius: 50%;
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 4px;
        }

        .history-action {
            font-weight: 600;
            color: var(--charcoal);
        }

        .history-status {
            font-size: 12px;
            padding: 2px 8px;
            border-radius: 10px;
        }

        .history-meta {
            font-size: 13px;
            color: var(--gray);
        }

        .history-note {
            font-size: 14px;
            color: var(--slate);
            margin-top: 6px;
            font-style: italic;
        }

        .history-hash {
            font-size: 12px;
            color: var(--gray);
            margin-top: 4px;
            font-family: monospace;
        }

        /* Verification Summary */
        .verification-stats {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .verification-stat {
            text-align: center;
            padding: 10px 16px;
            background: var(--pale-gray);
            border-radius: 6px;
        }

        .verification-stat .value {
            font-size: 20px;
            font-weight: 700;
        }

        .verification-stat .value.verified { color: var(--success); }
        .verification-stat .value.unverified { color: var(--gray); }
        .verification-stat .value.disputed { color: var(--error); }

        .verification-stat .label {
            font-size: 11px;
            color: var(--gray);
            text-transform: uppercase;
        }

        .verification-progress {
            margin-top: 16px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .progress-bar {
            flex: 1;
            height: 8px;
            background: var(--light-gray);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--success);
            border-radius: 4px;
        }

        .progress-text {
            font-size: 14px;
            font-weight: 500;
            min-width: 60px;
            text-align: right;
        }

        /* Full Width Section */
        .full-width {
            grid-column: 1 / -1;
        }
    </style>
</head>
<body>
    <header class="admin-header">
        <h1>Axis Allocation Admin</h1>
        <div class="admin-header-right">
            <span class="admin-email">{{ admin.email }}</span>
            <form method="POST" action="/admin/logout" style="display: inline;">
                <button type="submit" class="logout-btn">Sign Out</button>
            </form>
        </div>
    </header>

    <div class="admin-container">
        <a href="/admin/submissions" class="back-link">&larr; Back to All Submissions</a>

        {% if request.query_params.get('action') == 'approved' %}
        <div class="action-alert success">
            &#10003; Submission has been approved. The action is recorded in the Property Logbook.
        </div>
        {% elif request.query_params.get('action') == 'rejected' %}
        <div class="action-alert error">
            Submission has been rejected. The action is recorded in the Property Logbook.
        </div>
        {% endif %}

        <div class="page-header">
            <div class="page-header-left">
                <h2>{{ submission.full_address }}</h2>
                <div class="property-id-display">{{ submission.property_id }}</div>
            </div>
            <div class="page-header-right">
                <span class="status-badge status-{{ submission.status }}">
                    {{ submission.status.replace('_', ' ').title() }}
                </span>
            </div>
        </div>

        <div class="detail-grid">
            <!-- Main Content Column -->
            <div class="main-column">
                <!-- Property Information -->
                <div class="card">
                    <div class="card-header">
                        <h3>Property Information</h3>
                    </div>
                    <div class="card-body">
                        <div class="info-grid">
                            <div class="info-item">
                                <div class="info-label">Address</div>
                                <div class="info-value">{{ submission.full_address }}</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">Postcode</div>
                                <div class="info-value">{{ submission.postcode }}</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">Property Type</div>
                                <div class="info-value">{{ submission.property_type.replace('-', ' ').replace('_', ' ').title() }}</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">Tenure</div>
                                <div class="info-value">{{ submission.tenure.title() }}</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">Floor Area</div>
                                <div class="info-value">{{ submission.floor_area_sqm }} sqm</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">Guide Price</div>
                                <div class="info-value highlight">&pound;{{ "{:,}".format(submission.guide_price) }}</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">Sale Route</div>
                                <div class="info-value">{{ submission.sale_route.replace('_', ' ').title() }}</div>
                            </div>
                            {% if submission.bedrooms %}
                            <div class="info-item">
                                <div class="info-label">Bedrooms</div>
                                <div class="info-value">{{ submission.bedrooms }}</div>
                            </div>
                            {% endif %}
                            {% if submission.bathrooms %}
                            <div class="info-item">
                                <div class="info-label">Bathrooms</div>
                                <div class="info-value">{{ submission.bathrooms }}</div>
                            </div>
                            {% endif %}
                            {% if submission.year_built %}
                            <div class="info-item">
                                <div class="info-label">Year Built</div>
                                <div class="info-value">{{ submission.year_built }}</div>
                            </div>
                            {% endif %}
                            {% if submission.epc_rating %}
                            <div class="info-item">
                                <div class="info-label">EPC Rating</div>
                                <div class="info-value">{{ submission.epc_rating }}</div>
                            </div>
                            {% endif %}
                        </div>

                        {% if submission.tenure == 'leasehold' %}
                        <h4 style="margin-top: 20px; margin-bottom: 12px; font-size: 14px; color: var(--slate);">Leasehold Details</h4>
                        <div class="info-grid">
                            {% if submission.lease_years_remaining %}
                            <div class="info-item">
                                <div class="info-label">Lease Remaining</div>
                                <div class="info-value">{{ submission.lease_years_remaining }} years</div>
                            </div>
                            {% endif %}
                            {% if submission.ground_rent_annual %}
                            <div class="info-item">
                                <div class="info-label">Ground Rent</div>
                                <div class="info-value">&pound;{{ "{:,}".format(submission.ground_rent_annual) }}/year</div>
                            </div>
                            {% endif %}
                            {% if submission.service_charge_annual %}
                            <div class="info-item">
                                <div class="info-label">Service Charge</div>
                                <div class="info-value">&pound;{{ "{:,}".format(submission.service_charge_annual) }}/year</div>
                            </div>
                            {% endif %}
                        </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Agent Information -->
                <div class="card">
                    <div class="card-header">
                        <h3>Agent Information</h3>
                    </div>
                    <div class="card-body">
                        <div class="info-grid">
                            <div class="info-item">
                                <div class="info-label">Firm</div>
                                <div class="info-value">{{ submission.agent_firm }}</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">Agent Name</div>
                                <div class="info-value">{{ submission.agent_name }}</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">Email</div>
                                <div class="info-value">{{ submission.agent_email }}</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Documents -->
                <div class="card">
                    <div class="card-header">
                        <h3>Documents</h3>
                    </div>
                    <div class="card-body">
                        {% if documents %}
                        <ul class="document-list">
                            {% for doc in documents %}
                            <li class="document-item">
                                <div class="document-info">
                                    <div class="document-type">{{ doc.document_type.replace('_', ' ').title() }}</div>
                                    <div class="document-filename">{{ doc.filename }}</div>
                                </div>
                                <span class="document-size">{{ (doc.file_size_bytes / 1024)|round(1) }} KB</span>
                                <a href="{{ doc.download_url }}" class="download-btn" download>Download</a>
                            </li>
                            {% endfor %}
                        </ul>
                        {% else %}
                        <p style="color: var(--gray);">No documents uploaded yet.</p>
                        {% endif %}

                        {% if completeness.missing_documents %}
                        <div class="missing-docs" style="margin-top: 16px;">
                            <strong>Missing Required Documents:</strong>
                            <ul>
                                {% for doc in completeness.missing_documents %}
                                <li>{{ doc.replace('_', ' ').title() }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Integrity & Verification -->
                <div class="card">
                    <div class="card-header">
                        <h3>Trust &amp; Integrity</h3>
                    </div>
                    <div class="card-body">
                        <!-- Hash Chain -->
                        <h4 style="font-size: 13px; color: var(--slate); text-transform: uppercase; margin-bottom: 10px;">Hash Chain</h4>
                        {% if integrity.chain_valid %}
                        <div class="integrity-badge valid">
                            &#128274; Hash chain intact - No tampering detected
                        </div>
                        {% else %}
                        <div class="integrity-badge invalid">
                            &#9888; Hash chain broken - {{ integrity.verification_error or 'Integrity compromised' }}
                        </div>
                        {% endif %}

                        {% if integrity.current_version_hash %}
                        <div class="hash-display">
                            Current hash: <code>{{ integrity.current_version_hash[:16] }}...{{ integrity.current_version_hash[-8:] }}</code>
                        </div>
                        {% endif %}

                        {% if verification_summary %}
                        <!-- Verification Stats -->
                        <h4 style="font-size: 13px; color: var(--slate); text-transform: uppercase; margin: 24px 0 10px;">Fact Verification</h4>
                        <div class="verification-stats">
                            <div class="verification-stat">
                                <div class="value verified">{{ verification_summary.verified_count }}</div>
                                <div class="label">Verified</div>
                            </div>
                            <div class="verification-stat">
                                <div class="value unverified">{{ verification_summary.unverified_count }}</div>
                                <div class="label">Unverified</div>
                            </div>
                            <div class="verification-stat">
                                <div class="value">{{ verification_summary.submitted_count }}</div>
                                <div class="label">Pending</div>
                            </div>
                            {% if verification_summary.disputed_count > 0 %}
                            <div class="verification-stat">
                                <div class="value disputed">{{ verification_summary.disputed_count }}</div>
                                <div class="label">Disputed</div>
                            </div>
                            {% endif %}
                        </div>

                        <div class="verification-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: {{ verification_summary.verification_percentage }}%"></div>
                            </div>
                            <span class="progress-text">{{ verification_summary.verification_percentage|round(1) }}%</span>
                        </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Version History -->
                <div class="card">
                    <div class="card-header">
                        <h3>Property Logbook History</h3>
                    </div>
                    <div class="card-body">
                        <div class="history-timeline">
                            {% for version in history|reverse %}
                            <div class="history-item">
                                <div class="history-header">
                                    <span class="history-action">{{ version.action.replace('_', ' ').title() }}</span>
                                    <span class="history-status status-badge status-{{ version.status }}">
                                        {{ version.status.replace('_', ' ').title() }}
                                    </span>
                                </div>
                                <div class="history-meta">
                                    <span>{{ version.action_by }}</span> &middot;
                                    <span>{{ version.timestamp[:19].replace('T', ' ') }}</span>
                                </div>
                                {% if version.action_note %}
                                <div class="history-note">"{{ version.action_note }}"</div>
                                {% endif %}
                                <div class="history-hash">
                                    v{{ version.version_number }} &middot; {{ version.version_hash[:12] }}...
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sidebar Actions Column -->
            <div class="sidebar-column">
                <div class="card actions-card">
                    <div class="card-header">
                        <h3>Actions</h3>
                    </div>
                    <div class="card-body">
                        <!-- Quick Actions -->
                        {% if submission.status not in ['approved', 'rejected', 'withdrawn', 'archived'] %}
                        <div class="action-section">
                            <h4>Review Decision</h4>

                            <form method="POST" action="/admin/submissions/{{ submission.property_id }}/approve">
                                <textarea name="note" class="note-input" placeholder="Approval notes (optional)" rows="2"></textarea>
                                <button type="submit" class="action-btn approve">Approve Submission</button>
                            </form>

                            <form method="POST" action="/admin/submissions/{{ submission.property_id }}/reject">
                                <textarea name="note" class="note-input" placeholder="Rejection reason (required)" rows="2" required></textarea>
                                <button type="submit" class="action-btn reject">Reject Submission</button>
                            </form>
                        </div>
                        {% else %}
                        <div class="action-section">
                            <p style="color: var(--gray); font-size: 14px;">
                                This submission has been <strong>{{ submission.status.replace('_', ' ') }}</strong> and cannot be modified.
                            </p>
                        </div>
                        {% endif %}

                        <!-- Status Update -->
                        <div class="action-section">
                            <h4>Update Status</h4>
                            <form method="POST" action="/admin/submissions/{{ submission.property_id }}/status" class="status-form">
                                <select name="new_status">
                                    {% for status in statuses %}
                                    <option value="{{ status }}" {% if submission.status == status %}selected{% endif %}>
                                        {{ status.replace('_', ' ').title() }}
                                    </option>
                                    {% endfor %}
                                </select>
                                <input type="text" name="note" class="note-input" placeholder="Note (optional)" style="margin-bottom: 10px;">
                                <button type="submit" class="action-btn secondary">Update Status</button>
                            </form>
                        </div>

                        <!-- Submission Info -->
                        <div class="action-section">
                            <h4>Submission Info</h4>
                            <div style="font-size: 14px; color: var(--gray);">
                                <p><strong>Submitted:</strong> {{ logbook.created_at[:10] }}</p>
                                <p><strong>Versions:</strong> {{ logbook.version_count }}</p>
                                <p><strong>Documents:</strong> {{ completeness.document_count }} / {{ completeness.required_document_count }}</p>
                                <p><strong>Complete:</strong> {% if completeness.is_complete %}Yes{% else %}No{% endif %}</p>
                            </div>
                        </div>

                        <!-- Completeness Score (Admin Only) -->
                        <div class="action-section">
                            <h4>Completeness Score</h4>
                            <div class="completeness-score-display">
                                <div class="score-main {% if completeness_score.total_score >= 80 %}score-good{% elif completeness_score.total_score >= 60 %}score-partial{% else %}score-blocked{% endif %}">
                                    {{ completeness_score.total_score }}%
                                </div>
                                <div class="score-breakdown">
                                    <div class="score-item {% if completeness_score.core_fields_score == 40 %}check{% else %}missing{% endif %}">
                                        <span class="score-icon">{% if completeness_score.core_fields_score == 40 %}&#10003;{% else %}&#10007;{% endif %}</span>
                                        Required fields: {{ completeness_score.core_fields_complete }} / {{ completeness_score.core_fields_total }}
                                    </div>
                                    <div class="score-item {% if completeness_score.documents_score == 40 %}check{% else %}missing{% endif %}">
                                        <span class="score-icon">{% if completeness_score.documents_score == 40 %}&#10003;{% else %}&#10007;{% endif %}</span>
                                        Documents: {{ completeness_score.documents_uploaded }} / {{ completeness_score.documents_required }}
                                    </div>
                                    <div class="score-item {% if completeness_score.contextual_score == 20 %}check{% else %}partial{% endif %}">
                                        <span class="score-icon">{% if completeness_score.contextual_score == 20 %}&#10003;{% elif completeness_score.contextual_score > 0 %}~{% else %}&#10007;{% endif %}</span>
                                        Contextual: {{ completeness_score.contextual_fields_complete }} / {{ completeness_score.contextual_fields_total }}
                                    </div>
                                </div>

                                {% if completeness_score.is_blocked %}
                                <div class="blocking-reasons">
                                    <strong>Blocking Issues:</strong>
                                    <ul>
                                        {% for reason in completeness_score.blocking_reasons %}
                                        <li>{{ reason }}</li>
                                        {% endfor %}
                                    </ul>
                                </div>
                                {% elif completeness_score.missing_contextual_fields %}
                                <div class="optional-missing">
                                    <strong>Optional fields missing:</strong>
                                    <ul>
                                        {% for field in completeness_score.missing_contextual_fields %}
                                        <li>{{ field.replace('_', ' ').title() }}</li>
                                        {% endfor %}
                                    </ul>
                                </div>
                                {% endif %}
                            </div>
                        </div>

                        <!-- Quick Friction Log -->
                        <div class="action-section">
                            <h4>Log Friction</h4>
                            <p style="font-size: 12px; color: var(--gray); margin-bottom: 10px;">
                                Note any agent struggles with this submission.
                            </p>
                            <a href="/admin/friction?property_id={{ submission.property_id }}&agent_email={{ submission.agent_email }}" class="action-btn secondary" style="text-align: center; text-decoration: none;">
                                Log Friction Point
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <style>
        /* Completeness Score Styles */
        .completeness-score-display {
            background: var(--pale-gray);
            border-radius: 8px;
            padding: 16px;
        }

        .score-main {
            font-size: 32px;
            font-weight: 700;
            text-align: center;
            margin-bottom: 12px;
        }

        .score-main.score-good { color: var(--success); }
        .score-main.score-partial { color: var(--warning); }
        .score-main.score-blocked { color: var(--error); }

        .score-breakdown {
            font-size: 13px;
            color: var(--slate);
        }

        .score-item {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 4px 0;
        }

        .score-icon {
            width: 16px;
            text-align: center;
            font-weight: 600;
        }

        .score-item.check .score-icon { color: var(--success); }
        .score-item.missing .score-icon { color: var(--error); }
        .score-item.partial .score-icon { color: var(--warning); }

        .blocking-reasons {
            margin-top: 12px;
            padding: 10px;
            background: var(--error-bg);
            border-radius: 6px;
            font-size: 12px;
            color: var(--error);
        }

        .blocking-reasons ul {
            margin: 4px 0 0 16px;
            padding: 0;
        }

        .optional-missing {
            margin-top: 12px;
            padding: 10px;
            background: #fef3c7;
            border-radius: 6px;
            font-size: 12px;
            color: #92400e;
        }

        .optional-missing ul {
            margin: 4px 0 0 16px;
            padding: 0;
        }
    </style>
</body>
</html>
